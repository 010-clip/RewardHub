<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RewardHub - Mobile Dashboard</title>
<style>
  /*css style*\
</style>
</head>
<body>

<header>
  <h1>RewardHub</h1>
</header>

<main>
  <section id="dashboard" class="active">
    <div class="card" style="align-items: center;">
      <h3>Analytics</h3>
      <p>Track your progress, points earned, and activity trends.</p>
    </div>
    <div class="card" style="align-items: center;">
      <h3>Total Points</h3>
      <p class="points" id="total-points">Loading...</p>
    </div>
  </section>

  <section id="earn">
    <div class="horizontal-scroll">
      <div class="card" style="min-width: 150px;">
        <h3>Surveys</h3><p>Complete surveys to earn points</p><button class="button">Start</button>
      </div>
      <div class="card" style="min-width: 150px;">
        <h3>Games</h3><p>Play games and earn</p><button class="button">Play</button>
      </div>
      <div class="card" style="min-width: 150px;">
        <h3>Rewards</h3><p>Redeem your points</p><button class="button">Redeem</button>
      </div>
    </div>
  </section>

  <section id="cashout">
    <h2 class="section-title">Transaction History</h2>
    <div class="card">
      <table>
        <thead>
          <tr><th>Date</th><th>Reward</th><th>Points</th></tr>
        </thead>
        <tbody id="transaction-history">
          <!-- Filled dynamically -->
        </tbody>
      </table>
    </div>
  </section>
</main>

<nav class="bottom-nav">
  <button class="active" data-target="dashboard">
    <svg viewBox="0 0 24 24"><path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/></svg>Dashboard
  </button>
  <button data-target="earn">
    <svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>Earn
  </button>
  <button data-target="cashout">
    <svg viewBox="0 0 24 24"><path d="M12 3L2 12h3v8h14v-8h3L12 3zm0 2.84L17.16 12H14v6H10v-6H6.84L12 5.84z"/></svg>Cashout
  </button>
</nav>

<footer>
  &copy; 2025 RewardHub. All rights reserved.
</footer>

<script src="https://cdn.jsdelivr.net/npm/appwrite@13.0.0"></script>
<script>
  const client = new Appwrite.Client()
    .setEndpoint('https://fra.cloud.appwrite.io/v1') // Your Appwrite endpoint
    .setProject('68b185b20006861f905b'); // Your Appwrite project ID

  const account = new Appwrite.Account(client);
  const tablesDB = new Appwrite.TablesDB(client);

  const DATABASE_ID = 'RewardHubDB';
  const TABLE_ID = 'users';

  async function loadDashboard() {
    try {
      // 1. Get current user session
      const user = await account.get();
      const userId = user.$id;

      // 2. Try to get the user's row
      const response = await tablesDB.listRows(DATABASE_ID, TABLE_ID, [
        Appwrite.Query.equal('userId', userId)
      ]);

      let userRow;

      if (response.total === 0) {
        // 3. If user row doesn't exist, create it
        userRow = await tablesDB.createRow(
          DATABASE_ID,
          TABLE_ID,
          Appwrite.ID.unique(),
          { userId: userId, points: 0 }
        );
      } else {
        userRow = response.rows[0];
      }

      // 4. Populate points
      document.getElementById('total-points').innerText = userRow.points;

    } catch (err) {
      console.error('User not logged in or error:', err);
      window.location.href = '/'; // redirect to login
    }
  }

  // Initialize dashboard
  loadDashboard();


// Bottom navigation logic
const buttons = document.querySelectorAll('.bottom-nav button');
const sections = document.querySelectorAll('main section');

buttons.forEach(btn => {
  btn.addEventListener('click', () => {
    buttons.forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    const targetId = btn.getAttribute('data-target');
    sections.forEach(sec => sec.classList.remove('active'));
    document.getElementById(targetId).classList.add('active');
  });
});
</script>


</body>
</html>
