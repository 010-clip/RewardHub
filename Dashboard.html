<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RewardHub - Mobile Dashboard</title>
<style>
  /* Your CSS here */
</style>
</head>
<body>

<header>
  <h1>RewardHub</h1>
</header>

<main>
  <section id="dashboard" class="active">
    <div class="card" style="align-items: center;">
      <h3>Analytics</h3>
      <p>Track your progress, points earned, and activity trends.</p>
    </div>
    <div class="card" style="align-items: center;">
      <h3>Total Points</h3>
      <p class="points" id="total-points">Loading...</p>
    </div>
  </section>

  <section id="earn">
    <div class="horizontal-scroll">
      <div class="card" style="min-width: 150px;">
        <h3>Surveys</h3><p>Complete surveys to earn points</p><button class="button">Start</button>
      </div>
      <div class="card" style="min-width: 150px;">
        <h3>Games</h3><p>Play games and earn</p><button class="button">Play</button>
      </div>
      <div class="card" style="min-width: 150px;">
        <h3>Rewards</h3><p>Redeem your points</p><button class="button">Redeem</button>
      </div>
    </div>
  </section>

  <section id="cashout">
    <h2 class="section-title">Transaction History</h2>
    <div class="card">
      <table>
        <thead>
          <tr><th>Date</th><th>Reward</th><th>Points</th></tr>
        </thead>
        <tbody id="transaction-history"></tbody>
      </table>
    </div>
  </section>
</main>

<nav class="bottom-nav">
  <button class="active" data-target="dashboard">Dashboard</button>
  <button data-target="earn">Earn</button>
  <button data-target="cashout">Cashout</button>
</nav>

<footer>
  &copy; 2025 RewardHub. All rights reserved.
</footer>

<script src="https://cdn.jsdelivr.net/npm/appwrite@13.0.0"></script>
<script>
const client = new Appwrite.Client()
  .setEndpoint("https://fra.cloud.appwrite.io/v1")
  .setProject("68b185b20006861f905b");

const account = new Appwrite.Account(client);
const database = new Appwrite.Databases(client);

const DATABASE_ID = "68b18d62000e8278dc31"; // Your DB ID
const USERS_TABLE_ID = "data"; // Your table ID

async function loadDashboard() {
  try {
    // 1. Get current user
    const user = await account.get();
    const userId = user.$id;

    // 2. Check for user row
    const response = await database.listDocuments(DATABASE_ID, USERS_TABLE_ID, [
      Appwrite.Query.equal("userId", userId)
    ]);

    let userDoc;
    if (response.total === 0) {
      // Create if not exist
      userDoc = await database.createDocument(
        DATABASE_ID,
        USERS_TABLE_ID,
        Appwrite.ID.unique(),
        { userId, points: 0 }
      );
    } else {
      userDoc = response.documents[0];
    }

    // 3. Populate dashboard
    document.getElementById("total-points").innerText = userDoc.points;

  } catch (err) {
    console.error("Error loading dashboard:", err);
    window.location.href = "/"; // redirect to login
  }
}

loadDashboard();

// Bottom nav logic
const buttons = document.querySelectorAll('.bottom-nav button');
const sections = document.querySelectorAll('main section');
buttons.forEach(btn => {
  btn.addEventListener('click', () => {
    buttons.forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    const targetId = btn.getAttribute('data-target');
    sections.forEach(sec => sec.classList.remove('active'));
    document.getElementById(targetId).classList.add('active');
  });
});
</script>
</body>
</html>
